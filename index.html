<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>mcpacino/dm-snap-mv @ GitHub</title>

<style type="text/css">
	body {
		margin-top: 1.0em;
		color: #000000;
		font-family: "Helvetica,Arial,FreeSans";
	}

	#container {
		margin: 0 auto;
		width: 80%;
	}

	h1 { font-size: 3.3em; color: #878d0b; margin-bottom: 3px; }
	h1 .small { font-size: 0.4em; }
	h1 a { text-decoration: none }
	h2 { font-size: 1.5em; color: #878d0b; margin-top: 40px;}
	h3 { text-align: center; color: #878d0b; }
	a { color: #878d0b; }
	.description { color: #878d0b; font-size: 1.2em; margin-bottom: 50px; margin-top: 10px; font-style: italic;}
	.download { float: right; }
	pre { font-size: 1.1em; background: #eeeeee; padding: 15px; border-width: 2px 0px 2px 0px; border-color: #b0bfbf; border-style: solid;}
	hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
	.footer { text-align:center; padding-top:30px; font-style: italic; }
</style>

</head>


<body>
<a href="http://github.com/mcpacino/dm-snap-mv"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>

<div id="container">

<div class="download">
  <a href="http://github.com/mcpacino/dm-snap-mv/zipball/master">
    <img border="0" width="90" src="http://github.com/images/modules/download/zip.png"></a>
  <a href="http://github.com/mcpacino/dm-snap-mv/tarball/master">
    <img border="0" width="90" src="http://github.com/images/modules/download/tar.png"></a>
</div>

<h1><a href="http://github.com/mcpacino/dm-snap-mv">dm-snap-mv</a> <span class="small">by <a href="http://github.com/mcpacino">mcpacino</a></span></h1>

<div class="description">
  device-mapper snapshot multi-version
</div>



<h2>What is dm-snap-mv</h2>
<p><pre>
The dm-snap-mv is a target module for device-mapper, which can take
multiple snapshots against an existing block device(origin device).

All snapshots are saved in an independent block device(COW device).

The copy-on-write is used, so only diff-data will be saved in the COW device.


features
--------
1. snapshot of origin
2. snapshot of snapshot
3. instant snapshot creation and deletion
4. origin and snapshots are concurrent readable/writable
5. rollback snapshot to origin
6. multiple origin devices share a COW device
7. multiple COW devices are supported
</pre></p>


<h2>Download</h2>
<p>
  Download binary package from <a href="https://build.opensuse.org/package/show?package=dm-snap-mv&project=home%3Amcpacino">OBS</a> for:
</p>
<p>
  &nbsp;&nbsp;&nbsp;&nbsp;<a href="http://download.opensuse.org/repositories/home:/mcpacino/openSUSE_11.3/"><b>OpenSUSE 11.3</b></a>
</p>
<p>
  &nbsp;&nbsp;&nbsp;&nbsp;<a href="http://download.opensuse.org/repositories/home:/mcpacino/Fedora_13/"><b>Fedora 13</b></a>
</p>
<br>
<p>
  Clone the project with <a href="http://git-scm.com">Git</a>
  by running:
  <pre>$ git clone git://<a href="http://github.com/mcpacino/dm-snap-mv">github.com/mcpacino/dm-snap-mv</a></pre>
</p>
<p>
  Download the source code in either
  <a href="http://github.com/mcpacino/dm-snap-mv/zipball/master">zip</a> or
  <a href="http://github.com/mcpacino/dm-snap-mv/tarball/master">tar</a> formats.
</p>


<h2>Diagram</h2>
<p><pre>

           +---------------------+    +---------------+     +--------------+
   read <--|                     |-----               |     |              |
           |    origin dm_dev    |    |   origin_dev  | COW |              |
  write ---|                     |---->               |----->  snapshot-1  |
           +---------------------+    +--|------------+     |     ...      |
                                         |                  |     ...      |
           +---------------------+    +--|------------------+     ...      |
   read <--|                     |-------?-                    snapshot-N  |
           |  snapshot-X dm_dev  |    |         cow_dev                    |
  write ---|                     |---->                                    |
           +---------------------+    +------------------------------------+

  dm_dev: device-mapper device, created by "dmsetup create ..."
     COW: copy-on-write

</pre></p>


<h2>Usage examples</h2>
<p><pre>
origin device: sdb1     COW device: sdc1


<b># Init COW device, bind origin device to it. Create orig dm_dev</b>
    # <b>dms create orig sdb1 sdc1 -bF</b>
    # mount /dev/mapper/orig /mnt/orig
    # touch /mnt/orig/this-is-orig
    # ll /mnt/orig/
    -rw-r--r-- 1 root root 0 2010-10-19 21:39 this-is-orig


<b># Take a snapshot of origin. Create snap1 dm_dev</b>
    # <b>dms snapshot orig -m snap1</b>
    # <b>dms create snap1 sdb1 sdc1 1</b>
    # mount /dev/mapper/snap1 /mnt/snap1/
    # touch /mnt/snap1/this-is-snap1
    # ll /mnt/snap1/
    -rw-r--r-- 1 root root 0 2010-10-19 21:39 this-is-orig
    -rw-r--r-- 1 root root 0 2010-10-19 21:42 this-is-snap1


<b># Take a snapshot of snap1. Create snap2 dm_dev</b>
    # <b>dms snapshot orig 1 -m snap2</b>
    # <b>dms create snap2 sdb1 sdc1 2</b>
    # mount /dev/mapper/snap2 /mnt/snap2/
    # touch /mnt/snap2/this-is-snap2
    # ll /mnt/snap2/
    -rw-r--r-- 1 root root 0 2010-10-19 21:39 this-is-orig
    -rw-r--r-- 1 root root 0 2010-10-19 21:42 this-is-snap1
    -rw-r--r-- 1 root root 0 2010-10-19 21:43 this-is-snap2


<b># List all snapshots</b>
    # <b>dms list</b>
          origin-device : sdb1 (8:17)
             cow-device : sdc1 (8:33)
             chunk-size : 1 page(s)
          used-versions : 0% (3/640)
            used-chunks : 0% (946/7865817)
             cow-status : valid
               cleaning : no
            rollbacking : no
    YYYY/MM/DD HH:MM:SS   Tag   R   Chunks   DM_Dev   Memo
    2010/10/19 21:38:37   0     .   0        orig     "ORIGIN"
    2010/10/19 21:41:28   1     .   5        snap1    "snap1"
    2010/10/19 21:42:57   2     .   5        snap2    "snap2"


<b># Rollback snap2 to origin</b>
    # umount /mnt/orig
    # dms remove orig
    # <b>dms rollback snap2 2</b>
    # dms create orig sdb1 sdc1
    # mount /dev/mapper/orig /mnt/orig
    # touch /mnt/orig/this-is-orig-after-rollback
    # ll /mnt/orig
    -rw-r--r-- 1 root root 0 2010-10-19 21:39 this-is-orig
    -rw-r--r-- 1 root root 0 2010-10-19 22:04 this-is-orig-after-rollback
    -rw-r--r-- 1 root root 0 2010-10-19 21:42 this-is-snap1
    -rw-r--r-- 1 root root 0 2010-10-19 21:43 this-is-snap2


<b># Stop dm-snap-mv. Take a look at origin device sdb2</b>
    # umount /mnt/orig /mnt/snap1 /mnt/snap2
    # dmsetup remove_all
    # mount /dev/sdb1 /mnt/
    # ll /mnt/
    -rw-r--r-- 1 root root 0 2010-10-19 21:39 this-is-orig
    -rw-r--r-- 1 root root 0 2010-10-19 22:04 this-is-orig-after-rollback
    -rw-r--r-- 1 root root 0 2010-10-19 21:42 this-is-snap1
    -rw-r--r-- 1 root root 0 2010-10-19 21:43 this-is-snap2

</pre></p>


<h2>Dependencies</h2>
<p>device-mapper</p>
<p>kernel >= 2.6.33
<h2>License</h2>
<p>GLP</p>
<h2>Authors</h2>
<p>Cong Meng</p>
<h2>Contact</h2>
<p>mcpacino@gmail.com<br/></p>

<div class="footer">
  get the source code on GitHub : <a href="http://github.com/mcpacino/dm-snap-mv">mcpacino/dm-snap-mv</a>
</div>

  </div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-18949836-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>
</html>
